<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .radar-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
    }

    .radar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.5)30%, rgba(0,0,0,0) 70%);
        position: relative;
        border: 2px solid rgba(112, 112, 112, 0.1); 
        overflow: hidden;
    }

    .radar::before {
        content: "";
        width: 100%;
        height: 100%;
        position: absolute;
        background: linear-gradient(45deg, rgba(5, 2, 182, 0.5), rgba(0, 255, 0, 0));
        transform-origin: center;
        animation: rotateRadar 2s linear infinite;
    }

    @keyframes rotateRadar {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Logo in der Mitte */
    .radar-logo {
        position: absolute;
        width: 80px;  /* GrÃ¶ÃŸe anpassen */
        height: auto;
        z-index: 2; /* Stellt sicher, dass das Logo Ã¼ber dem Radar liegt */
    }
    
    .alert-container {
        position: absolute;
        bottom: 20px; /* Abstand zur unteren Kante */
        left: 10%;
        right: 10%;
        width: 80%;
        text-align: center;
    }
    </style>
</head>
<body>
<!-- NavBar Configuration -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">RescueRadar</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="https://github.com/ResQdev/RescueRadar">GitHub</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle {{ 'show' if error }}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="{{ 'true' if error else 'false' }}">
                  Login
                </a>
                <div class="dropdown-menu p-3 {{ 'show' if error }}" style="min-width: 250px;">

                  {% if error is defined and error%}
                    <div class="alert alert-danger text-center p-2" style="font-size: 0.9rem;">
                      {{ error }}
                    </div>
                  {% endif %}
                
                  <form method="POST" action="/">
                    <div class="mb-2">
                      <input type="text" name="username" class="form-control" placeholder="Benutzername" required>
                    </div>
                    <div class="mb-2">
                      <input type="password" name="password" class="form-control" placeholder="Kennwort" required>
                    </div>
                    <div class="text-center">
                      <button type="submit" class="btn btn-primary w-100">Anmelden</button>
                    </div>
                  </form>
                </div>
              </li>              
            </ul>              
          </div>
        </div>
      </nav>

<!-- Radar-Container -->
    <div class="radar-container my-4">
        <div class="radar"></div>
        <img src="{{ url_for('static', filename='RescueRadar_v2.png') }}" alt="RescueRadar Logo" class="radar-logo">
    </div>

<!-- Ã–ffentliche Warnmeldung -->
    <div class="container text-center alert-container">
        <h3 id="warningMessage" class="alert alert-success">
            âœ… Aktuell liegen keine Warnungen vor.
        </h3>
    </div>
 

 <!-- Standort-Logik -->
<script>
  function generateSessionId() {
    return 'xxxxxxx'.replace(/x/g, () => (Math.random() * 36 | 0).toString(36));
  }

  const sessionId = sessionStorage.getItem("session_id") || generateSessionId();
  sessionStorage.setItem("session_id", sessionId);

  function showWarning(active) {
    const messageElement = document.getElementById("warningMessage");
    if (active) {
      messageElement.innerText = "ðŸš¨ Achtung, Einsatzfahrzeug! Bitte sorge fÃ¼r eine freie Fahrt!";
      messageElement.className = "alert alert-danger";
    } else {
      messageElement.innerText = "âœ… Aktuell liegen keine Warnungen vor.";
      messageElement.className = "alert alert-success";
    }
  }

  function sendUserLocation() {
    navigator.geolocation.getCurrentPosition(position => {
      fetch("/update_location_public", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          session_id: sessionId,
          latitude: position.coords.latitude,
          longitude: position.coords.longitude
        })
      })
      .then(response => response.json())
      .then(data => {
        showWarning(data.nearby); // true oder false vom Server
      });
    });
  }

  setInterval(sendUserLocation, 5000); // alle 5 Sekunden
</script>

</body>
</html>